<?xml version="1.0" encoding="UTF-8"?>

<project basedir="." name="NFV-SOL3">

<description>Ant Script A3</description>

<property name="gen.dir" location="${basedir}/gen-src"/>
<property name="schema.dir" location="${basedir}/xsd"/>

<property name="serviceName" value="NfvService"/>
<property name="servicePath.prefix" value = "it/polito/dp2/NFV/sol3/service"/>

<property name="shared.location" location="/opt/dp2/shared"/>
<property name="ext.lib.dir" location="${shared.location}/lib" />

<property name="Neo4JSimpleXMLURL" value="http://localhost:${tomcatPort}/Neo4JSimpleXML/rest" />
<property name="WADL" value="${Neo4JSimpleXMLURL}/application.wadl"/>

<!-- Target init -->
<target name="init">
	<mkdir dir="${gen.dir}" />
</target>


<taskdef name="wjc" classname="org.jvnet.ws.wadl2java.WJCTask">
   <classpath>
	   	<fileset dir="${ext.lib.dir}" includes="*.jar" />
   </classpath>
</taskdef>


<target name="generate-artifacts">
	<mkdir dir="${gen.dir}" />
		   	<echo message="Compiling the descriptions..." />
		   	<wjc description="${WADL}" package="it.polito.dp2.NFV.sol3.service1"
		       autoSchemaPackage="false" target="${gen.dir}">
		     <customizations dir="${lab3.location}" includes="binding.xjc"/>
		     <produces dir="${gen.dir}/it/polito/dp2/NFV/sol3/service1" includes="*.java"/>
		     <depends dir="${lab3.location}" includes="build.xml"/>
	</wjc>
</target>


<path id="classpath">
	<fileset dir="${lib.dir}">
		<include name="**/*.jar" />
	</fileset>
	<fileset dir="${ext.lib.dir}">
	    <include name="*.jar" />
		<exclude name="ant-*.jar"/>
	</fileset>
</path>


<target name="-chk-bindings">
	<uptodate property="generate-bindings.notRequired" targetfile="${gen.dir}/.flagfile">
		<srcfiles dir="${schema.dir}" includes="**/*.xsd" />
	</uptodate>	
</target>

<target name="generate-bindings" unless="generate-bindings.notRequired" depends="init,-chk-bindings" description="Generate bindings from schema">
	<exec executable="xjc" failonerror="true">
		<arg value="-d" />
		<arg value="${gen.dir}" />
		<arg value="-p" />
		<arg value="it.polito.dp2.NFV.sol3.service2" />
		<arg value="${schema.dir}/NfvDeployer.xsd" />
	</exec>
	<touch file="${gen.dir}/.flagfile" />
</target>


<target name="build-service" depends="build-service1, generate-bindings" description="Build the solution of Assignment 3">
		<echo>Building the submitted solution (if needed)...</echo>
		<javac
			destdir="${build.dir}"
			debug="${debug}"
			debuglevel="${debuglevel}"
			source="${source}"
			target="${target}"
			includeantruntime="false"> 
			<compilerarg    line="-encoding GBK "/>
				<src path="${src.dir}"/>
				<src path="${gen.dir}"/>
				<include name="it/polito/dp2/NFV/sol3/service2/*.java" />
				<include name="it/polito/dp2/NFV/sol3/service/*.java" />
				<classpath>
					<path refid="classpath" />
				</classpath>
		</javac>
		<echo>Done.</echo>
</target>


<!-- Target build -->
		<target name="build-service1" depends="generate-artifacts" description="Build the solution of Assignment 3">
			<echo>Building the submitted solution (if needed)...</echo>
			<javac
				destdir="${build.dir}"
				debug="${debug}"
				debuglevel="${debuglevel}"
				source="${source}"
				target="${target}"
				includeantruntime="false"> 
					<src path="${src.dir}"/>
					<src path="${gen.dir}"/>
					<include name="it/polito/dp2/NFV/sol3/service1/*.java" />
					<classpath>
						<path refid="classpath" />
					</classpath>
			</javac>
			<echo>Done.</echo>
	</target>
	
	<!-- define the "build-client" target -->
	<target name="build-client" >
		<echo>Compiling client...</echo>
		<javac destdir="${build.dir}"
				includeantruntime="false"
				debug="${debug}"
				debuglevel="${debuglevel}"
				source="${source}"
				target="${target}">
			<src path="${src.dir}"/>
			<include name="it/polito/dp2/NFV/sol3/*/*.java"/>
			<include name="it/polito/dp2/NFV/sol3/*/*/*.java"/>
			<classpath>
				<path refid="classpath"/>
			</classpath>
		</javac>
	</target> 

</project>
